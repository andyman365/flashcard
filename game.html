<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Toetsmodus - Flashcards</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet">
<style>
:root {
    --bg: #f6f7fb;
    --card: #ffffff;        /* container achtergrond */
    --header: #ffcc66;
    --text: #1f2937;        /* donkere tekst in light mode */
    --button: #2563eb;
    --button-text: white;
    --answer-bg: #334155;   /* knoppen */
    --answer-text: white;
    --correct: #16a34a;
    --wrong: #dc2626;
}

body.dark {
    --bg: #0f172a;
    --card: #1e293b;        /* container achtergrond in dark mode */
    --header: #ffb84d;
    --text: #f2f2f2;        /* lichte tekst in dark mode */
    --button: #3b82f6;
    --button-text: white;
    --answer-bg: #334155;
    --answer-text: white;
    --correct: #16a34a;
    --wrong: #dc2626;
}

/* body en container */
body {
    margin: 0;
    font-family: 'Nunito', sans-serif;
    background: var(--bg);
    color: var(--text);
    transition: 0.3s;
}

/* ---------- HEADER ---------- */
.header {
    background: var(--header);
    padding: 15px 25px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: sticky;
    top: 0;
    z-index: 10;
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
}

/* Header items layout: flex container */
.header-left { font-weight: 700; font-size: 20px; }
.header-center { position: absolute; left: 50%; transform: translateX(-50%); }
.header-right button {
    margin-left: 10px;
    border: none;
    padding: 8px 14px;
    border-radius: 12px;
    cursor: pointer;
    font-size: 14px;
}

/* ---------- CONTAINER ---------- */
.container {
    max-width: 600px;
    margin: 40px auto;
    background: var(--card);   /* <-- verander naar variabele */
    padding: 30px;
    border-radius: 16px;
    box-shadow: 0 0 20px rgba(0,0,0,0.3);
    color: var(--text);        /* tekstkleur volgen variabele */
}

/* ---------- TOETS ---------- */
h1 {
    text-align: center;
    margin-bottom: 20px;
}

.question {
    font-size: 20px;
    margin-bottom: 20px;
}

.answers button {
    width: 100%;
    padding: 12px;
    margin-bottom: 10px;
    border: none;
    border-radius: 8px;
    background: var(--answer-bg); /* achtergrondknop via variabele */
    color: var(--answer-text);    /* tekstkleur via variabele */
    cursor: pointer;
    transition: 0.2s;
}

.answers button:hover {
    filter: brightness(0.9);
}
.correct { background-color: var(--correct) !important; color: white; }
.wrong { background-color: var(--wrong) !important; color: white; }

.next-btn {
    margin-top: 15px;
    padding: 10px;
    width: 100%;
    border-radius: 8px;
    border: none;
    background: var(--button);
    color: white;
    cursor: pointer;
}
.next-btn:hover { background: #1d4ed8; }

.score { margin-top: 15px; font-size: 18px; text-align: center; }

.score-display {
    margin-top: 25px;
    padding: 20px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 12px;
    color: white;
    text-align: center;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
}

.score-label {
    font-size: 14px;
    opacity: 0.9;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 8px;
}

.score-value {
    font-size: 48px;
    font-weight: 700;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    animation: pulse 0.6s ease-in-out;
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

.score-subtitle {
    font-size: 12px;
    margin-top: 10px;
    opacity: 0.85;
}

.flashcard-btn {
    font-size: 18px;          /* groter lettertype */
    padding: 12px 28px;       /* grotere knop */
    border-radius: 16px;      /* ronde hoeken */
    border: none;
    background: #2563eb;      /* moderne blauwe kleur */
    color: white;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2); /* lichte schaduw */
    transition: 0.2s;
}

.flashcard-btn:hover {
    background: #1d4ed8;      /* donkerder blauw bij hover */
    transform: translateY(-2px);
}
.coming-soon {
    text-align: center;
    font-size: 36px;
    color: var(--text);
    opacity: 0.6;
    margin: 15px 0 25px 0;
    font-style: italic;
    transition: 0.3s;
}
body.dark .coming-soon {
    color: #ccc; /* lichtere tekst in dark mode */
}

/* ---------- MODAL ---------- */
.modal {
    display: none;
    position: fixed;
    z-index: 100;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
    align-items: center;
    justify-content: center;
}

.modal.show {
    display: flex;
}

.modal-content {
    background: var(--card);
    padding: 40px;
    border-radius: 16px;
    box-shadow: 0 0 30px rgba(0,0,0,0.5);
    max-width: 400px;
    width: 90%;
    text-align: center;
}

.modal-content h2 {
    margin-top: 0;
    margin-bottom: 20px;
}

.modal-content input {
    width: 100%;
    padding: 12px;
    margin-bottom: 20px;
    border: 2px solid var(--button);
    border-radius: 8px;
    font-family: 'Nunito', sans-serif;
    font-size: 16px;
    box-sizing: border-box;
    background: var(--card);
    color: var(--text);
}

.modal-buttons {
    display: flex;
    gap: 10px;
    justify-content: center;
}

.modal-buttons button {
    padding: 12px 25px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-family: 'Nunito', sans-serif;
    font-size: 16px;
    transition: 0.2s;
}

.modal-buttons .save-btn {
    background: var(--button);
    color: white;
}

.modal-buttons .save-btn:hover {
    filter: brightness(0.9);
}

.modal-buttons .skip-btn {
    background: #ccc;
    color: var(--text);
}

.modal-buttons .skip-btn:hover {
    background: #aaa;
}

.game-end-modal {
    display: none;
    position: fixed;
    z-index: 100;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
    align-items: center;
    justify-content: center;
}

.game-end-modal.show {
    display: flex;
}

.game-end-content {
    background: var(--card);
    padding: 40px;
    border-radius: 16px;
    box-shadow: 0 0 30px rgba(0,0,0,0.5);
    max-width: 500px;
    width: 90%;
    text-align: center;
}

.game-end-content h2 {
    font-size: 32px;
    margin: 0 0 20px 0;
    color: var(--button);
}

.final-score {
    font-size: 48px;
    font-weight: 700;
    margin: 20px 0;
    color: var(--button);
}

.game-end-buttons {
    display: flex;
    gap: 15px;
    justify-content: center;
    margin-top: 30px;
    flex-wrap: wrap;
}

.game-end-buttons button {
    padding: 12px 25px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-family: 'Nunito', sans-serif;
    font-size: 16px;
    transition: 0.2s;
}

.game-end-buttons .primary-btn {
    background: var(--button);
    color: white;
}

.game-end-buttons .primary-btn:hover {
    filter: brightness(0.9);
}

.game-end-buttons .secondary-btn {
    background: #ccc;
    color: var(--text);
}

.game-end-buttons .secondary-btn:hover {
    background: #aaa;
}
</style>
</head>
<body>

<!-- ---------- HEADER ---------- -->
<div class="header">
    <div class="header-left">Toetsmodus</div>
    <div class="header-center">
        <button class="flashcard-btn" onclick="goToFlashcards()">ğŸ“š Ga terug naar Flashcards</button>
    </div>
    <div class="header-right">
        <button onclick="goToLeaderboard()">ğŸ† Leaderboard</button>
        <button onclick="toggleTheme()">ğŸŒ™ / â˜€ï¸</button>
        <button onclick="logout()" style="background: #dc2626;">Logout</button>
    </div>
</div>

<!-- ---------- USERNAME MODAL ---------- -->
<div class="modal" id="usernameModal">
    <div class="modal-content">
        <h2 id="welcomeText">Welcome!</h2>
        <p id="usernameDisplay" style="font-size: 18px; margin: 20px 0; font-weight: bold;"></p>
        <div class="modal-buttons">
            <button class="save-btn" onclick="startGame()">Start Game</button>
        </div>
    </div>
</div>

<!-- ---------- GAME END MODAL ---------- -->
<div class="game-end-modal" id="gameEndModal">
    <div class="game-end-content">
        <h2>Game Over!</h2>
        <p>Your final score:</p>
        <div class="final-score" id="finalScore">0</div>
        <div class="game-end-buttons">
            <button class="primary-btn" onclick="saveAndPlayAgain()">Save & Play Again</button>
            <button class="secondary-btn" onclick="viewLeaderboard()">View Leaderboard</button>
        </div>
    </div>
</div>

<!-- ---------- CONTAINER ---------- -->
<div class="container">
    <div class="question" id="question"></div>
    <div class="answers" id="answers"></div>
    <button class="next-btn" onclick="nextQuestion()">Volgende vraag</button>
    <button class="next-btn" onclick="endGame()" style="background: #dc2626; margin-top: 10px;">Spel beÃ«indigen</button>
    
    <div class="score-display">
        <div class="score-label">ğŸ¯ Jouw Score</div>
        <div class="score-value">
            <span id="score">0</span>
            <span>punten</span>
        </div>
        <div class="score-subtitle">
            <span id="rankDisplay" style="display: none;">Ranking: #<span id="userRank">-</span></span>
            <span id="noRankDisplay">Speel om op het scorebord te verschijnen</span>
        </div>
    </div>
</div>
<!-- Coming soon tekst -->
<div class="coming-soon">
    Net de learderboard toegevoegd - meer features komen eraan! ğŸš€
</div>


<script>
/* ---------- FLASHCARDS ---------- */
const flashcards = [
    { begrip: "Grondwet", betekenis: "Het belangrijkste wetboek van een land, waarin de rechten van burgers en de spelregels voor de overheid staan." },
    { begrip: "Trias politica", betekenis: "Scheiding der machten: wetgevende, uitvoerende en rechtsprekende macht zijn gescheiden om machtsmisbruik te voorkomen." },
    { begrip: "Kabinet", betekenis: "Alle ministers en staatssecretarissen samen; zij voeren het regeringsbeleid uit." },
    { begrip: "Minister-president", betekenis: "De leider van het kabinet en voorzitter van de ministerraad, ook wel premier genoemd." },
    { begrip: "Ministerraad", betekenis: "Vergadering van alle ministers onder leiding van de premier; hier worden belangrijke besluiten genomen." },
    { begrip: "Demissionair kabinet", betekenis: "Een kabinet dat na een val van de regering of verkiezingen allÃ©Ã©n lopende zaken afhandelt." },
    { begrip: "Tweede Kamer", betekenis: "Volksvertegenwoordiging gekozen door burgers (direct); heeft recht om wetten te maken en de regering te controleren." },
    { begrip: "Eerste Kamer", betekenis: "Kamer van 'heroverweging'; beoordeelt wetten op uitvoerbaarheid en rechtmatigheid, maar mag geen wetsvoorstellen indienen." },
    { begrip: "Staten-Generaal", betekenis: "Gezamenlijke naam voor de Eerste en Tweede Kamer." },
    { begrip: "Fractie", betekenis: "Alle Kamerleden van dezelfde politieke partij samen." },
    { begrip: "Fractiediscipline", betekenis: "Afspraken binnen een fractie om hetzelfde stemgedrag te vertonen." },
    { begrip: "Coalitie", betekenis: "Samenwerking van meerdere partijen om een regering te vormen." },
    { begrip: "Oppositie", betekenis: "Partijen die niet meeregeren, maar de regering kritisch volgen." },
    { begrip: "Regeerakkoord", betekenis: "Het contract met plannen en afspraken van partijen die samen een kabinet vormen." },
    { begrip: "Rijksbegroting", betekenis: "Overzicht van inkomsten en uitgaven van de overheid voor het komende jaar." },
    { begrip: "Algemene Beschouwingen", betekenis: "Groot politiek debat over de plannen van het kabinet, na Prinsjesdag." },
    { begrip: "Motie van wantrouwen", betekenis: "Uitspraak van de Tweede Kamer dat zij een minister of het kabinet niet meer vertrouwt." },
    { begrip: "Motie van treurnis", betekenis: "Kritische uitspraak van onvrede, minder zwaar dan een motie van wantrouwen." },
    { begrip: "Parlementaire enquÃªte", betekenis: "Groot onderzoek door de Tweede Kamer naar het functioneren van bestuur of beleid." },
    { begrip: "Miljoenennota", betekenis: "Toelichting bij de Rijksbegroting, gepresenteerd op Prinsjesdag." },
    { begrip: "Prinsjesdag", betekenis: "Jaarlijks moment waarop de koning de troonrede voorleest en de begroting wordt aangeboden. Altijd op de derde dinsdag van september." },
    { begrip: "Raad van State", betekenis: "Adviesorgaan over wetsvoorstellen en hoogste bestuursrechter in Nederland." },
    { begrip: "Provinciale Staten", betekenis: "Provinciale volksvertegenwoordiging, kiest onder andere de Eerste Kamer." },
    { begrip: "Gemeenteraad", betekenis: "Het lokale volksvertegenwoordigend orgaan van een gemeente." },
    { begrip: "College van B&W", betekenis: "Het dagelijks bestuur van de gemeente (burgemeester en wethouders)."},

    { begrip: "Stakeholder", betekenis: "Iemand of een groep die belang heeft bij een bepaalde beslissing, ontwikkeling of verandering, zoals burgers, bedrijven, de overheid of maatschappelijke organisaties." },
    { begrip: "Belang", betekenis: "Het voordeel of nadeel dat iemand ervaart bij een besluit of ontwikkeling. Dit kan financieel, sociaal, cultureel of moreel zijn." },
    { begrip: "Macht", betekenis: "Het vermogen van een persoon of groep om invloed uit te oefenen op anderen en zo besluiten of gedragingen te sturen." },
    { begrip: "Machtsmiddel", betekenis: "Een hulpmiddel waarmee iemand macht kan uitoefenen, zoals geld, kennis, een functie of toegang tot de media." },
    { begrip: "Invloed", betekenis: "De mogelijkheid om de mening of het gedrag van anderen te veranderen, ook zonder formele macht." },
    { begrip: "Lobby", betekenis: "Het (vaak achter de schermen) proberen politici en bestuurders te overtuigen van een standpunt, bijvoorbeeld door bedrijven of belangengroepen." },
    { begrip: "Belangengroep", betekenis: "Een georganiseerde groep die opkomt voor de belangen van een specifieke groep mensen, zoals vakbonden of consumentenorganisaties." },
    { begrip: "Pressiegroep", betekenis: "Een groep die actief druk uitoefent op politici of bestuurders om iets te veranderen, bijvoorbeeld door acties of campagnes." },
    { begrip: "Media", betekenis: "Krant, televisie, radio en sociale media die informatie verspreiden en zo de mening van het publiek kunnen beÃ¯nvloeden." },
    { begrip: "Opiniepeiling", betekenis: "Een onderzoek waarbij wordt gevraagd wat mensen ergens van vinden, bijvoorbeeld over een politieke partij of maatregel." },
    { begrip: "Protest", betekenis: "Een manier om actief te laten zien dat je het oneens bent met een besluit of situatie, bijvoorbeeld door een actie of manifestatie." },
    { begrip: "Demonstratie", betekenis: "Een bijeenkomst van mensen die samen in het openbaar protesteren om aandacht te vragen voor een onderwerp." },
    { begrip: "Petitie", betekenis: "Een schriftelijk verzoek van burgers aan de overheid of politiek, vaak met handtekeningen, om iets te veranderen." },
    { begrip: "Referendum", betekenis: "Een volksstemming waarin burgers zich direct uitspreken over een politieke kwestie of wetsvoorstel." },
    { begrip: "Actiegroep", betekenis: "Een tijdelijke groep burgers die zich inzet voor Ã©Ã©n specifiek doel, vaak met acties zoals flyers, campagnes of bijeenkomsten." },
    { begrip: "Belangenconflict", betekenis: "Een situatie waarin de belangen van verschillende personen of groepen botsen, bijvoorbeeld werknemers versus werkgevers." },
    { begrip: "Compromis", betekenis: "Een oplossing waarbij alle betrokken partijen een deel van hun wensen opgeven om samen tot een akkoord te komen." },
    { begrip: "Akkoord", betekenis: "Een officiÃ«le afspraak tussen partijen over een bepaald onderwerp, zoals een regeerakkoord of klimaatakkoord." },
    { begrip: "Onderhandeling", betekenis: "Een gesprek waarbij partijen met verschillende belangen proberen een gezamenlijke oplossing te vinden." },
    { begrip: "Wetgeving", betekenis: "Het geheel van wetten dat door de regering en het parlement wordt gemaakt en ingevoerd." },
    { begrip: "Beleid", betekenis: "Een plan of strategie van de overheid waarmee wordt geprobeerd bepaalde doelen te bereiken, bijvoorbeeld op het gebied van zorg of onderwijs." },
    { begrip: "Besluitvorming", betekenis: "Het proces waarin keuzes worden gemaakt door politici of bestuurders, vaak na overleg en debat." },
    { begrip: "Status quo", betekenis: "De huidige situatie die vaak lastig te veranderen is omdat veel partijen er belang bij hebben dat die blijft zoals hij is." },
    { begrip: "Publieke opinie", betekenis: "De heersende mening van (een groot deel van) de bevolking over een bepaald onderwerp of thema." },
    { begrip: "Veranderingstraject", betekenis: "Het hele proces waarin een idee uitgroeit tot een besluit en vervolgens wordt uitgevoerd, met alle stappen en obstakels die daarbij horen." }
];

let score = 0;
let currentCorrectAnswer = "";
let gameActive = true;
let currentUsername = "";
let questionCount = 0;

function shuffle(array){ return array.sort(()=>Math.random()-0.5); }

function nextQuestion(){
    if (!gameActive) return;
    
    questionCount++;

    const randomCard = flashcards[Math.floor(Math.random() * flashcards.length)];
    currentCorrectAnswer = randomCard.begrip;
    document.getElementById("question").innerText = randomCard.betekenis;

    let wrongAnswers = shuffle(flashcards.filter(c=>c.begrip!==currentCorrectAnswer).map(c=>c.begrip)).slice(0,3);
    let answerOptions = shuffle([currentCorrectAnswer,...wrongAnswers]);

    const answersDiv=document.getElementById("answers");
    answersDiv.innerHTML="";
    answersDiv.style.pointerEvents = "auto";
    
    answerOptions.forEach(option=>{
        const btn=document.createElement("button");
        btn.innerText=option;
        btn.onclick=()=>checkAnswer(btn,option);
        answersDiv.appendChild(btn);
    });
}

function checkAnswer(button, selected){
    const buttons=document.querySelectorAll(".answers button");
    buttons.forEach(b=>b.disabled=true);

    let pointsEarned = 0;
    if(selected===currentCorrectAnswer){ 
        score++; 
        pointsEarned = 1;
        button.classList.add("correct"); 
    }
    else{ 
        score--; 
        pointsEarned = -1;
        button.classList.add("wrong"); 
        buttons.forEach(b=>{ if(b.innerText===currentCorrectAnswer)b.classList.add("correct"); }); 
    }

    document.getElementById("score").innerText=score;
    
    // Update rank display
    if (currentUsername) {
        updateUserRank();
        saveScoreAfterQuestion(pointsEarned);
    }
}

function endGame() {
    gameActive = false;
    document.getElementById("question").innerText = "Game Over! Your score will be saved.";
    document.getElementById("answers").innerHTML = "";
    document.getElementById("answers").style.pointerEvents = "none";
    document.getElementById("finalScore").innerText = score;
    document.getElementById("gameEndModal").classList.add("show");
}

async function saveScore() {
    if (!currentUsername) return false;
    
    try {
        const response = await fetch('/api/scores', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                username: currentUsername, 
                score: score 
            })
        });
        
        const data = await response.json();
        return data.success;
    } catch (error) {
        console.error('Error saving score:', error);
        return false;
    }
}

async function updateUserRank() {
    if (!currentUsername) return;
    
    try {
        const response = await fetch('/api/scores');
        const data = await response.json();
        
        if (data.success && data.scores) {
            // Find user's rank
            const userScore = data.scores.find(s => s.username.toLowerCase() === currentUsername.toLowerCase());
            
            if (userScore) {
                document.getElementById("rankDisplay").style.display = "block";
                document.getElementById("noRankDisplay").style.display = "none";
                document.getElementById("userRank").innerText = userScore.rank;
            } else {
                document.getElementById("rankDisplay").style.display = "none";
                document.getElementById("noRankDisplay").style.display = "block";
            }
        }
    } catch (error) {
        console.error('Error fetching rank:', error);
    }
}

async function saveScoreAfterQuestion(points) {
    if (!currentUsername) return;
    
    try {
        await fetch('/api/scores', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                username: currentUsername, 
                score: points
            })
        });
    } catch (error) {
        console.error('Error auto-saving score:', error);
    }
}

function startGameWithUsername() {
    startGame();
}

function startGameAnon() {
    startGame();
}

function startGame() {
    document.getElementById("usernameModal").classList.remove("show");
    score = 0;
    questionCount = 0;
    gameActive = true;
    document.getElementById("score").innerText = "0";
    updateUserRank(); // Show initial rank
    nextQuestion();
}

async function saveAndPlayAgain() {
    document.getElementById("gameEndModal").classList.remove("show");
    const saved = await saveScore();
    if (saved) {
        alert("Score saved! Playing again...");
    } else {
        alert("Failed to save score, but you can play again!");
    }
    showUsernameModal();
}

function viewLeaderboard() {
    window.location.href = 'leaderboard.html';
}

function showUsernameModal() {
    document.getElementById("usernameDisplay").innerText = currentUsername;
    document.getElementById("welcomeText").innerText = `Welcome, ${currentUsername}!`;
    document.getElementById("usernameModal").classList.add("show");
}

function toggleTheme(){ 
    document.body.classList.toggle("dark"); 
    localStorage.setItem("theme",document.body.classList.contains("dark")?"dark":"light"); 
}

function goToFlashcards(){ 
    window.location.href="index.html"; 
}

function goToLeaderboard() {
    window.location.href="leaderboard.html";
}

function logout() {
    localStorage.removeItem('token');
    localStorage.removeItem('username');
    window.location.href = 'login.html';
}

const savedTheme=localStorage.getItem("theme"); 
if(savedTheme==="dark"){ document.body.classList.add("dark"); }

window.addEventListener('load', () => {
    // Check if user is logged in
    const token = localStorage.getItem('token');
    const username = localStorage.getItem('username');
    
    if (!token || !username) {
        // Redirect to login
        window.location.href = 'login.html';
        return;
    }
    
    currentUsername = username;
    showUsernameModal();
});
</script>
</body>
</html>